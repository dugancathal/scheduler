#!/usr/bin/env ruby

require 'optparse'
#require 'ruby-debug'
dirname = File.dirname(__FILE__)
require File.join(dirname, 'scheduler')
Dir['*.rb'].each do |rb_file|
  require File.join(dirname, rb_file)
end

options = {}
options[:file] = ARGV[-1] if File.exists?(ARGV[-1])
options[:mode] = []
unless ARGV.empty?
  OptionParser.new do |opts|
    opts.on("-d", "--detailed", "Detailed Output") do |d|
      options[:mode] << :detailed_stats
    end

    opts.on("-v", "--verbose", "Verbose Output") do |v|
      options[:mode] << :verbose_stats
    end

    opts.on("-t", "--type TYPE", "Type of Scheduler",
                                  "Should be one of: FCFSScheduler, RRScheduler") do |t|
      t = 'Sim::' + t                              
      options[:type] = instance_eval(t)
    end                              
  end.parse!
end
options[:file] ||= 'simulation.input'
options[:mode] = [:default_stats] if options[:mode].empty?
options[:type] ||= Sim::FCFSScheduler
ARGV.clear

#Sim::Scheduler.new.run! options[:mode]

Sim::System.new.run! options
