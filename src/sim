#!/usr/bin/env ruby

require 'optparse'
dirname = File.dirname(__FILE__)
Dir['*.rb'].each do |rb_file|
  require File.join(dirname, rb_file)
end


module Sim
  class Scheduler
    attr_accessor :stats, :out, :in
    attr_accessor :process_table, :current_pid
    attr_accessor :current_thread_id

    PROCESS_COMPLETION_OVERHEAD = 1
    THREAD_COMPLETION_OVERHEAD  = 1

    def self.run!(input = STDIN, output = STDOUT)
      @in, @out = input, output
      prelims = input.gets.chomp.split.map {|n| n.to_i }
      @stats = { number_of_processes:     prelims[0],
                 thread_switch_overhead:  prelims[1],
                 process_switch_overhead: prelims[2] }
    end

    def output_idle
      @out.puts "I"
    end

    def running_thread
      @out.puts "R #{@current_pid} #{@current_thread_id}"
    end

    def context_switch
      @out.puts "C #{@current_pid} #{@current_thread_id}"
    end
    
    def finished
      @out.puts "-"
    end
  end
end

unless ARGV.empty?
  OptionParser.new do |opts|
    opts.on("-d", "--detailed", "Detailed Output") do |d|
      options[:detailed] = d
    end

    opts.on("-v", "--verbose", "Verbose Output") do |v|
      options[:verbose] = v
    end
  end.parse!
end

ARGV.clear

Sim::Scheduler.run!